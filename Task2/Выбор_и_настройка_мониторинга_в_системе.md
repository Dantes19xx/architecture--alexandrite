1. Мотивация

Внедрение мониторинга является неотъемлемой частью жизненного цикла приложения.

 - Обеспечение стабильности. Команда разработчиков сможет оперативно устранять сбои и деградацию производительности
 - Ускоренная диагностика проблем
 - Возможность прогнозирования нагрузок. Когда в БД мониторинга, скажем в Prometheus накопится достаточное количество исторических данных по метрикам.
 - Безопасность и аудит. Можно мониторить подозрительную активность.
 - Улучшение UX. Заблаговременно выявленная ошибка, до того как пользователи сами ее обнаружат. Уменьшение оттока аудитории.
 - Улучшение CI/CD. Заранее обнаруженная регрессия улучшает CI. Приложение откатывается до того, как перестанет работать.

2. Выбор подхода к мониторингу
 - Для всех компонентов системы буду использовать TFGS, потому что паттерн является универсальным и информативным.
 - Для приложений (internet shop, CRM, MES) и БД так же подключу USE метрики, для мониторинга памяти, вдруг что то отъедает ОЗУ.

3. Какие метрики и в каких частях будут отслеживаться

- Мониторинг 5xx ошибок в API
	Number of HTTP 500 for shop API
	Number of HTTP 500 for CRM API
	Number of HTTP 500 for MES API

- RPS\Латентность для API
	Number of requests (RPS) for internet shop API
	Number of requests (RPS) for CRM API
	Number of requests (RPS) for MES API
	Response time (latency) for shop API
	Response time (latency) for CRM API
	Response time (latency) for MES API

- RMQ
	Number of dead-letter-exchange letters in RabbitMQ
	Number of message in flight in RabbitMQ

- Объем данных, передаваемых и принимаемых (Нужно для расчета целесообразности подключения BackPressure)
	Kb tranferred (received) for shop API
	Kb tranferred (received) for CRM API
	Kb tranferred (received) for MES API
	Kb provided (sent) for shop API
	Kb provided (sent) for CRM API
	Kb provided (sent) for MES API

- Количество коннекшенов необходимо для своевременного реагирования на внезапное уваеличение траффика. В дни скидок\акций будет много запросов.
  Как правило, каждый запрос открывает для себя коннекшен в БД. Иногда они не закрываются, что может повлечь за собой 504 статус код для приложения и
  деградацию латентности
	Number of connections for shop db instance
	Number of connections for MES db instance

- Опционально можно следить за размером БД, если дисковое пространство на сервере ограничено
    Size of S3 storage
    Size of shop db instance
    Size of MES db instance

4. План действий

- Установлю Prometheus, он будет моей time-series БД
- Создам его инстанс
- Настрою экспортеры в своем приложении
- Настрою экспортеры для низкоуровневых компонентов например node_exporter
- Настрою экспортер для RMQ
- Настрою экспортер для БД
- Настрою трейсинг через Jaeger или OpenTelemetry
- Визуализирую в графане свои метрики
- Настрою алертинг для дашбордов
- Настрою healthchecks для сервисов